%% example LaTeX script including macro definitions and parameter tables generated from a parameter file
%% (Tom Tetzlaff, 2022)

\documentclass[10pt,a4paper,american]{article}
\usepackage{geometry}
\geometry{verbose,a4paper,tmargin=2cm,bmargin=2cm,lmargin=2cm,rmargin=2cm}
\usepackage{amsmath}
\usepackage[table]{xcolor}
\renewcommand\familydefault{cmss}
\usepackage[breaklinks=true,colorlinks=true,linkcolor=blue,citecolor=blue,urlcolor=blue,filecolor=blue]{hyperref}

\usepackage{cleveref}
\crefformat{table}{Table\,#2#1#3}

\usepackage{minted}

\usepackage{longtable}

%% the following is required to make \input{} work within tables
\makeatletter
\AddToHook{env/longtable/begin}{\let\input\@@input}
\makeatother

\setlength{\LTcapwidth}{\linewidth}  %% width of longtable caption

\begin{document}

\title{\texttt{dict2tex} example}
\author{Tom Tetzlaff}
\date{\today}

\maketitle
\tableofcontents

\section{Parameter tables}

\cref{tab:parameter_table} constitutes an example of a parameter table automatically generated from the parameter dictionary \texttt{params.json} (see \cref{app:parameter_file}) using the configuration defined in \texttt{config.yml} (see \cref{app:config_file}):

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Parameter table
\def\cptn{Model and simulation parameters. Secondary parameters derived from primary parameters are marked in gray}
\renewcommand{\arraystretch}{1.5}
\begin{longtable}{|p{0.2\linewidth-2\tabcolsep}|p{0.2\linewidth-2\tabcolsep}|p{0.6\linewidth-2\tabcolsep}|}
  \caption{\cptn~(continued on next page).}
  \label{tab:parameter_table}
  \endfoot
  \caption{\cptn.}
  \endlastfoot
  %%%%%%%%%%%%
  \hline
  \input{parameter_table.tex} %% generated by example.py from params.json
\end{longtable}  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{table}[ht!]
% \begin{center}
%   \parbox{0.8\linewidth}{       %% use parbox to define table width within latex
%     \small%
%     \centering%
%     \renewcommand{\arraystretch}{1.5}%
%     \noindent%
%     \input{parameter_table.tex} %% generated by example.py from params.json
%     \caption{Model and simulation parameters. Secondary parameters derived from primary parameters are marked in gray.}
%     \label{tab:parameter_table}
%   }
% \end{center}
% \end{table}

\section{LaTeX macros for parameter names}

%% macros definitions
\input{macros.tex}   %% generated by example.py from params.json

The following text examples use LaTeX macros for parameter names automatically generated from a dictionary provided in \texttt{params.json}:
\begin{itemize}
\item The size \PN of the network was chosen such that everybody is impressed.
\item Application of TTX is micked by setting the spike threshold \PVth to infinity.
\item The weight $\PJI=-\Pg\PJ$ of inhibitory synapses plays no role.
\end{itemize}
%%
For an overview, the macro definitions can be visualized in a table such as \cref{tab:macros_table}.
The table is automatically generated from the parameter dictionary \texttt{params.json} (see \cref{app:parameter_file}) using the configuration defined in \texttt{config.yml} (see \cref{app:config_file}).
%%
\par
Macro names are automatically generated from the keys of the parameter dictionary (column ``Name (code)'' in \cref{tab:macros_table}) by removing underscores (``\verb+_+''), and by adding a prefix (here ``\verb+P+'') to avoid potential collisions with other LaTeX functions. The prefix can be configured by defining \verb+macros_prefix+ in \texttt{config.yml}.
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Macros table
\def\cptn{Overview of parameter macro definitions}
\begin{longtable}{|p{0.2\linewidth-2\tabcolsep}|p{0.2\linewidth-2\tabcolsep}|p{0.2\linewidth-2\tabcolsep}|p{0.4\linewidth-2\tabcolsep}|}  
  \caption{\cptn~(continued on next page).}
  \label{tab:macros_table}
  \endfoot
  \caption{\cptn.}
  \endlastfoot
  %%%%%%%%%%%%  
  \hline
  \input{macros_table.tex}   %% generated by example.py from params.json
\end{longtable}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \begin{table}[ht!]
% \begin{center}
%   \parbox{0.8\linewidth}{       %% use parbox to define table width within latex
%     \small%
%     \centering%
%     \renewcommand{\arraystretch}{1.5}%
%     \noindent%
%     \input{macros_table.tex} %% generated by example.py from params.json
%     \caption{Overview of parameter macro definitions.}
%     \label{tab:macros_table}
%   }
% \end{center}
% \end{table}

\clearpage

\begin{appendix}
  
  \section{Parameter file \texttt{params.json}}
  \label{app:parameter_file}
  {\footnotesize
    \inputminted{json}{params.json}  
  }
  
  \clearpage
  
  \section{Configuration file \texttt{config.yml}}
  \label{app:config_file}
  {\footnotesize
    \inputminted{yaml}{config.yml}  
  }
\end{appendix}

%%%%%%%%%%%%%%%

\end{document}
 
%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
